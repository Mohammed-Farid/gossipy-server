# Migration `20200419075445`

This migration has been generated by Mohammed Farid at 4/19/2020, 7:54:46 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "prod"."Comment" DROP CONSTRAINT IF EXiSTS "Comment_membershipId_fkey",
DROP CONSTRAINT IF EXiSTS "Comment_stationId_fkey",
DROP CONSTRAINT IF EXiSTS "Comment_topicId_fkey",
DROP CONSTRAINT IF EXiSTS "Comment_userId_fkey",
ALTER COLUMN "membershipId" DROP NOT NULL,
ALTER COLUMN "stationId" DROP NOT NULL,
ALTER COLUMN "topicId" DROP NOT NULL,
ALTER COLUMN "userId" DROP NOT NULL;

ALTER TABLE "prod"."Membership" DROP CONSTRAINT IF EXiSTS "Membership_stationId_fkey",
DROP CONSTRAINT IF EXiSTS "Membership_userId_fkey",
ALTER COLUMN "stationId" DROP NOT NULL,
ALTER COLUMN "userId" DROP NOT NULL;

ALTER TABLE "prod"."Topic" DROP CONSTRAINT IF EXiSTS "Topic_membershipId_fkey",
DROP CONSTRAINT IF EXiSTS "Topic_stationId_fkey",
DROP CONSTRAINT IF EXiSTS "Topic_userId_fkey",
ALTER COLUMN "membershipId" DROP NOT NULL,
ALTER COLUMN "stationId" DROP NOT NULL,
ALTER COLUMN "userId" DROP NOT NULL;

ALTER TABLE "prod"."Vote" DROP CONSTRAINT IF EXiSTS "Vote_membershipId_fkey",
DROP CONSTRAINT IF EXiSTS "Vote_stationId_fkey",
DROP CONSTRAINT IF EXiSTS "Vote_topicId_fkey",
DROP CONSTRAINT IF EXiSTS "Vote_userId_fkey",
ALTER COLUMN "membershipId" DROP NOT NULL,
ALTER COLUMN "stationId" DROP NOT NULL,
ALTER COLUMN "topicId" DROP NOT NULL,
ALTER COLUMN "userId" DROP NOT NULL;

ALTER TABLE "prod"."Comment" ADD FOREIGN KEY ("stationId")REFERENCES "prod"."Station"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "prod"."Comment" ADD FOREIGN KEY ("userId")REFERENCES "prod"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "prod"."Comment" ADD FOREIGN KEY ("membershipId")REFERENCES "prod"."Membership"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "prod"."Comment" ADD FOREIGN KEY ("topicId")REFERENCES "prod"."Topic"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "prod"."Membership" ADD FOREIGN KEY ("userId")REFERENCES "prod"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "prod"."Membership" ADD FOREIGN KEY ("stationId")REFERENCES "prod"."Station"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "prod"."Topic" ADD FOREIGN KEY ("userId")REFERENCES "prod"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "prod"."Topic" ADD FOREIGN KEY ("membershipId")REFERENCES "prod"."Membership"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "prod"."Topic" ADD FOREIGN KEY ("stationId")REFERENCES "prod"."Station"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "prod"."Vote" ADD FOREIGN KEY ("stationId")REFERENCES "prod"."Station"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "prod"."Vote" ADD FOREIGN KEY ("userId")REFERENCES "prod"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "prod"."Vote" ADD FOREIGN KEY ("membershipId")REFERENCES "prod"."Membership"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "prod"."Vote" ADD FOREIGN KEY ("topicId")REFERENCES "prod"."Topic"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200417085329-v3..20200419075445
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("SCHEMA_URL")
 }
 // output   = "../generated"
 generator client {
@@ -40,65 +40,65 @@
   updatedAt   DateTime     @default(now())
 }
 model Topic {
-  id           Int        @default(autoincrement()) @id
+  id           Int         @default(autoincrement()) @id
   title        String
   identifier   String
   content      String
-  image        String?    @default("")
-  sealed       Boolean    @default(false)
-  membershipId Int
-  userId       Int
-  stationId    Int
-  user         User       @relation(fields: [userId], references: [id])
-  membership   Membership @relation(fields: [membershipId], references: [id])
-  station      Station    @relation(fields: [stationId], references: [id])
+  image        String?     @default("")
+  sealed       Boolean     @default(false)
+  membershipId Int?
+  userId       Int?
+  stationId    Int?
+  user         User?       @relation(fields: [userId], references: [id])
+  membership   Membership? @relation(fields: [membershipId], references: [id])
+  station      Station?    @relation(fields: [stationId], references: [id])
   comments     Comment[]
   votes        Vote[]
-  createdAt    DateTime   @default(now())
-  updatedAt    DateTime   @default(now())
+  createdAt    DateTime    @default(now())
+  updatedAt    DateTime    @default(now())
 }
 model Comment {
-  id           Int        @default(autoincrement()) @id
+  id           Int         @default(autoincrement()) @id
   content      String
-  image        String?    @default("")
-  membershipId Int
-  userId       Int
-  topicId      Int
-  stationId    Int
-  station      Station    @relation(fields: [stationId], references: [id])
-  user         User       @relation(fields: [userId], references: [id])
-  membership   Membership @relation(fields: [membershipId], references: [id])
-  topic        Topic      @relation(fields: [topicId], references: [id])
-  createdAt    DateTime   @default(now())
-  updatedAt    DateTime   @default(now())
+  image        String?     @default("")
+  membershipId Int?
+  userId       Int?
+  topicId      Int?
+  stationId    Int?
+  station      Station?    @relation(fields: [stationId], references: [id])
+  user         User?       @relation(fields: [userId], references: [id])
+  membership   Membership? @relation(fields: [membershipId], references: [id])
+  topic        Topic?      @relation(fields: [topicId], references: [id])
+  createdAt    DateTime    @default(now())
+  updatedAt    DateTime    @default(now())
 }
 model Vote {
-  id           Int        @default(autoincrement()) @id
+  id           Int         @default(autoincrement()) @id
   type         VoteType
-  membershipId Int
-  userId       Int
-  topicId      Int
-  stationId    Int
-  station      Station    @relation(fields: [stationId], references: [id])
-  user         User       @relation(fields: [userId], references: [id])
-  membership   Membership @relation(fields: [membershipId], references: [id])
-  topic        Topic      @relation(fields: [topicId], references: [id])
-  createdAt    DateTime   @default(now())
-  updatedAt    DateTime   @default(now())
+  membershipId Int?
+  userId       Int?
+  topicId      Int?
+  stationId    Int?
+  station      Station?    @relation(fields: [stationId], references: [id])
+  user         User?       @relation(fields: [userId], references: [id])
+  membership   Membership? @relation(fields: [membershipId], references: [id])
+  topic        Topic?      @relation(fields: [topicId], references: [id])
+  createdAt    DateTime    @default(now())
+  updatedAt    DateTime    @default(now())
 }
 model Membership {
   id        Int       @default(autoincrement()) @id
   role      Role      @default(MEMBER)
   state     State     @default(PENDING)
-  userId    Int
-  stationId Int
-  user      User      @relation(fields: [userId], references: [id])
-  station   Station   @relation(fields: [stationId], references: [id])
+  userId    Int?
+  stationId Int?
+  user      User?     @relation(fields: [userId], references: [id])
+  station   Station?  @relation(fields: [stationId], references: [id])
   topics    Topic[]
   comments  Comment[]
   votes     Vote[]
   createdAt DateTime  @default(now())
```


