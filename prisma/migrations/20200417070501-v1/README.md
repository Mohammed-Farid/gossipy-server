# Migration `20200417070501-v1`

This migration has been generated by Mohammed Farid at 4/17/2020, 7:05:01 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Role" AS ENUM ('FOUNDER', 'ADMIN', 'MODERATOR', 'MEMBER');

CREATE TYPE "State" AS ENUM ('PENDING', 'ACTIVE', 'DETACHED', 'BANNED');

CREATE TYPE "VoteType" AS ENUM ('UPVOTE', 'DOWNVOTE');

CREATE TABLE "prod"."User" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "email" text  NOT NULL ,
    "id" SERIAL,
    "identifier" text  NOT NULL ,
    "image" text  NOT NULL ,
    "name" text  NOT NULL ,
    "password" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id")
) 

CREATE TABLE "prod"."Station" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "description" text  NOT NULL ,
    "id" SERIAL,
    "identifier" text  NOT NULL ,
    "image" text  NOT NULL ,
    "name" text  NOT NULL ,
    "public" boolean  NOT NULL DEFAULT false,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id")
) 

CREATE TABLE "prod"."Topic" (
    "content" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" SERIAL,
    "identifier" text  NOT NULL ,
    "image" text  NOT NULL ,
    "membershipId" integer  NOT NULL ,
    "sealed" boolean  NOT NULL DEFAULT false,
    "stationId" integer  NOT NULL ,
    "title" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "prod"."Comment" (
    "content" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" SERIAL,
    "image" text  NOT NULL ,
    "membershipId" integer  NOT NULL ,
    "stationId" integer  NOT NULL ,
    "topicId" integer  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "prod"."Vote" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" SERIAL,
    "membershipId" integer  NOT NULL ,
    "stationId" integer  NOT NULL ,
    "topicId" integer  NOT NULL ,
    "type" "VoteType" NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "prod"."Membership" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" SERIAL,
    "role" "Role" NOT NULL DEFAULT 'MEMBER',
    "state" "State" NOT NULL DEFAULT 'PENDING',
    "stationId" integer  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "prod"."_StationToUser" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

CREATE UNIQUE INDEX "User.identifier" ON "prod"."User"("identifier")

CREATE UNIQUE INDEX "User.email" ON "prod"."User"("email")

CREATE UNIQUE INDEX "Station.identifier" ON "prod"."Station"("identifier")

CREATE UNIQUE INDEX "_StationToUser_AB_unique" ON "prod"."_StationToUser"("A","B")

CREATE  INDEX "_StationToUser_B_index" ON "prod"."_StationToUser"("B")

ALTER TABLE "prod"."Topic" ADD FOREIGN KEY ("userId")REFERENCES "prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."Topic" ADD FOREIGN KEY ("membershipId")REFERENCES "prod"."Membership"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."Topic" ADD FOREIGN KEY ("stationId")REFERENCES "prod"."Station"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."Comment" ADD FOREIGN KEY ("stationId")REFERENCES "prod"."Station"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."Comment" ADD FOREIGN KEY ("userId")REFERENCES "prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."Comment" ADD FOREIGN KEY ("membershipId")REFERENCES "prod"."Membership"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."Comment" ADD FOREIGN KEY ("topicId")REFERENCES "prod"."Topic"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."Vote" ADD FOREIGN KEY ("stationId")REFERENCES "prod"."Station"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."Vote" ADD FOREIGN KEY ("userId")REFERENCES "prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."Vote" ADD FOREIGN KEY ("membershipId")REFERENCES "prod"."Membership"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."Vote" ADD FOREIGN KEY ("topicId")REFERENCES "prod"."Topic"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."Membership" ADD FOREIGN KEY ("userId")REFERENCES "prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."Membership" ADD FOREIGN KEY ("stationId")REFERENCES "prod"."Station"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."_StationToUser" ADD FOREIGN KEY ("A")REFERENCES "prod"."Station"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."_StationToUser" ADD FOREIGN KEY ("B")REFERENCES "prod"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200417070501-v1
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,125 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("SCHEMA_URL")
+}
+
+// output   = "../generated"
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id          Int          @default(autoincrement()) @id
+  name        String
+  image       String
+  identifier  String       @unique
+  email       String       @unique
+  password    String
+  stations    Station[]    @relation(references: [id])
+  memberships Membership[]
+  topics      Topic[]
+  comments    Comment[]
+  votes       Vote[]
+  createdAt   DateTime     @default(now())
+  updatedAt   DateTime     @default(now())
+}
+
+model Station {
+  id          Int          @default(autoincrement()) @id
+  name        String
+  image       String
+  identifier  String       @unique
+  description String
+  users       User[]       @relation(references: [id])
+  memberships Membership[]
+  topics      Topic[]
+  comments    Comment[]
+  votes       Vote[]
+  public      Boolean      @default(false)
+  createdAt   DateTime     @default(now())
+  updatedAt   DateTime     @default(now())
+}
+
+model Topic {
+  id           Int        @default(autoincrement()) @id
+  title        String
+  identifier   String
+  content      String
+  image        String
+  sealed       Boolean    @default(false)
+  membershipId Int
+  userId       Int
+  stationId    Int
+  user         User       @relation(fields: [userId], references: [id])
+  membership   Membership @relation(fields: [membershipId], references: [id])
+  station      Station    @relation(fields: [stationId], references: [id])
+  comments     Comment[]
+  votes        Vote[]
+  createdAt    DateTime   @default(now())
+  updatedAt    DateTime   @default(now())
+}
+
+model Comment {
+  id           Int        @default(autoincrement()) @id
+  content      String
+  image        String
+  membershipId Int
+  userId       Int
+  topicId      Int
+  stationId    Int
+  station      Station    @relation(fields: [stationId], references: [id])
+  user         User       @relation(fields: [userId], references: [id])
+  membership   Membership @relation(fields: [membershipId], references: [id])
+  topic        Topic      @relation(fields: [topicId], references: [id])
+  createdAt    DateTime   @default(now())
+  updatedAt    DateTime   @default(now())
+}
+
+model Vote {
+  id           Int        @default(autoincrement()) @id
+  type         VoteType
+  membershipId Int
+  userId       Int
+  topicId      Int
+  stationId    Int
+  station      Station    @relation(fields: [stationId], references: [id])
+  user         User       @relation(fields: [userId], references: [id])
+  membership   Membership @relation(fields: [membershipId], references: [id])
+  topic        Topic      @relation(fields: [topicId], references: [id])
+  createdAt    DateTime   @default(now())
+  updatedAt    DateTime   @default(now())
+}
+
+model Membership {
+  id        Int       @default(autoincrement()) @id
+  role      Role      @default(MEMBER)
+  state     State     @default(PENDING)
+  userId    Int
+  stationId Int
+  user      User      @relation(fields: [userId], references: [id])
+  station   Station   @relation(fields: [stationId], references: [id])
+  topics    Topic[]
+  comments  Comment[]
+  votes     Vote[]
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @default(now())
+}
+
+enum Role {
+  FOUNDER
+  ADMIN
+  MODERATOR
+  MEMBER
+}
+
+enum State {
+  PENDING
+  ACTIVE
+  DETACHED
+  BANNED
+}
+
+enum VoteType {
+  UPVOTE
+  DOWNVOTE
+}
```


