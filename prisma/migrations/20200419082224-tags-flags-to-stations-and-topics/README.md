# Migration `20200419082224-tags-flags-to-stations-and-topics`

This migration has been generated by Mohammed Farid at 4/19/2020, 8:22:24 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "prod"."Tag" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" SERIAL,
    "name" text  NOT NULL ,
    "stationId" integer  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id")
) 

CREATE TABLE "prod"."_TagToTopic" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

CREATE UNIQUE INDEX "_TagToTopic_AB_unique" ON "prod"."_TagToTopic"("A","B")

CREATE  INDEX "_TagToTopic_B_index" ON "prod"."_TagToTopic"("B")

ALTER TABLE "prod"."Tag" ADD FOREIGN KEY ("stationId")REFERENCES "prod"."Station"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."_TagToTopic" ADD FOREIGN KEY ("A")REFERENCES "prod"."Tag"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "prod"."_TagToTopic" ADD FOREIGN KEY ("B")REFERENCES "prod"."Topic"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200419080031..20200419082224-tags-flags-to-stations-and-topics
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("SCHEMA_URL")
 }
 // output   = "../generated"
 generator client {
@@ -23,8 +23,23 @@
   createdAt   DateTime     @default(now())
   updatedAt   DateTime     @default(now())
 }
+model Membership {
+  id        Int       @default(autoincrement()) @id
+  role      Role      @default(MEMBER)
+  state     State     @default(PENDING)
+  userId    Int
+  stationId Int
+  user      User      @relation(fields: [userId], references: [id])
+  station   Station   @relation(fields: [stationId], references: [id])
+  topics    Topic[]
+  comments  Comment[]
+  votes     Vote[]
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @default(now())
+}
+
 model Station {
   id          Int          @default(autoincrement()) @id
   name        String
   image       String?      @default("")
@@ -34,8 +49,9 @@
   memberships Membership[]
   topics      Topic[]
   comments    Comment[]
   votes       Vote[]
+  tags        Tag[]
   public      Boolean      @default(false)
   createdAt   DateTime     @default(now())
   updatedAt   DateTime     @default(now())
 }
@@ -54,8 +70,9 @@
   membership   Membership @relation(fields: [membershipId], references: [id])
   station      Station    @relation(fields: [stationId], references: [id])
   comments     Comment[]
   votes        Vote[]
+  tags         Tag[]      @relation(references: [id])
   createdAt    DateTime   @default(now())
   updatedAt    DateTime   @default(now())
 }
@@ -89,21 +106,16 @@
   createdAt    DateTime   @default(now())
   updatedAt    DateTime   @default(now())
 }
-model Membership {
-  id        Int       @default(autoincrement()) @id
-  role      Role      @default(MEMBER)
-  state     State     @default(PENDING)
-  userId    Int
+model Tag {
+  id        Int      @default(autoincrement()) @id
+  name      String
   stationId Int
-  user      User      @relation(fields: [userId], references: [id])
-  station   Station   @relation(fields: [stationId], references: [id])
-  topics    Topic[]
-  comments  Comment[]
-  votes     Vote[]
-  createdAt DateTime  @default(now())
-  updatedAt DateTime  @default(now())
+  station   Station  @relation(fields: [stationId], references: [id])
+  topics    Topic[]  @relation(references: [id])
+  createdAt DateTime @default(now())
+  updatedAt DateTime @default(now())
 }
 enum Role {
   FOUNDER
```


